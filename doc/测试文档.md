# 测试文档说明

<!--ts-->

* [测试文档说明](#测试文档说明)
   * [测试目录](#测试目录)
      * [test-string](#test-string)
      * [test-server-interpreter](#test-server-interpreter)
      * [test-server-parser](#test-server-parser)
      * [test-server-scripts](#test-server-scripts)
         * [script01](#script01)
         * [script02](#script02)
         * [script03](#script03)
         * [script04](#script04)
         * [script05](#script05)
         * [script06](#script06)
         * [script07](#script07)
         * [script08](#script08)
         * [script09](#script09)

<!--te-->

测试代码目录在`./test`中

通过googletest框架完成主要函数，如parser和interpreter以及部分工具代码的单元测试。

安装方法通过cmake 3.14 的 FetchContent_Declare 来进行自动化安装

## 测试目录

### test-string

> 测试utils 中string的工具函数是否能够正常工作

---

### test-server-interpreter

> 测试解释器中的生成speak值是否符合预期

---

### test-server-parser

> 测试解析器中的parseLine函数以及parseTokens函数

---

### test-server-scripts

> \* 非gtest框架测试
>
> 测试各种脚本，根据脚本是否合法给出错误提示或通过提示

---

#### script01

测试正常脚本，数据涵盖到所有变量，计时器，silence等

```text
# 正常可执行脚本，测试所有数据

Step main   # 入口步骤
    Speak "欢迎，" + $name + "，进入dsl测试系统"
    Branch "查询账单" , searchAmount
    Branch "查询话费" , searchCredit
    Branch "查询信息" , searchData
    Branch "反馈" , feedback
    Branch "退出" , exit
    Listen 1 , 10
    Silence silence
    Default default

Step bill
    Speak $name + ",您好，您的账单是：" + $amount
    Branch "查询账单" , searchAmount
    Branch "查询话费" , searchCredit
    Branch "查询信息" , searchData
    Branch "反馈" , feedback
    Branch "退出" , exit
    Listen 10 , 30
    Silence silence
    Default default
    
Step searchAmount
    Speak "您好，您的账单是：" + $amount
    Exit
Step searchCredit
    Speak "您好，您的话费是：" + $credit
    Exit
Step searchData
    Speak "您好，您的信息是：" + $data + "，" + "还有什么需要查询的吗？"
    Branch "查询账单" , searchAmount
    Branch "查询话费" , searchCredit
    Branch "查询信息" , searchData
    Branch "反馈" , feedback
    Branch "退出" , exit
    Listen 10 , 30
    Silence silence
    Default default
Step feedback
    Speak "请问您有什么问题需要反馈吗？"
    Listen 10 , 30
    Silence exit
    Default exit
Step exit
    Exit
Step silence
    Speak "您好，我没听清楚您说的是什么？"
    Branch "查询账单" , searchAmount
    Branch "查询话费" , searchCredit
    Branch "查询信息" , searchData
    Branch "反馈" , feedback
    Branch "退出" , exit
    Default default
Step default
    Speak "未查询到您需要的内容，您可以尝试以下操作："
    Branch "查询账单" , searchAmount
    Branch "查询话费" , searchCredit
    Branch "查询信息" , searchData
    Branch "反馈" , feedback
    Branch "退出" , exit


```

#### script02

测试未包含分支的报错

```text
Step main   # 入口步骤
    Speak "hello" + "world"
    Branch "账单" , bill
    Listen 10 , 30
    Silence silence
    Default default
Step silence
    Speak "您好，我没听清楚您说的是什么？"

Step bill
    Speak $name + ",您好，您的账单是：" + $amount
    Branch "查询话费" , searchCredit
    # 测试未包含的分支
    Branch "查询信息" , searchData
    Listen 10 , 30
Step default
    Speak "请问您还有什么需要补充的吗？"
    Branch "账单" , bill
```

#### script03

测试非法的command

```text
# 测试非法命令
asddddddddd
ddddddd
```

#### script04

测试hello wolrd中间空白行的报错

```text
# 测试speak命令中多余的空白行
Step hello
    Speak    "Hello world"
```

#### script05

测试Listen 的数字分隔的报错

```text
# 测试listen的参数识别
Step hello
    Speak "hello,world"
    Listen 12,25
```

#### script06

测试Branch 的参数识别

```text
# 测试Branch的参数识别
Step hello
    Speak "hello,world"
    Listen 12 , 25
    Branch "loop" ,  
```

#### script07

测试Silence的参数识别

```text
# 测试Silence的参数识别
Step hello
    Speak "hello,world"
    Listen 12 , 25
    Branch "loop" ,  hello
    Silence 
```

#### script08

正常脚本

```text
Step hello
    Speak "hello,world"
    Listen 12 , 25
    Branch "loop" ,  hello
    Silence __default
Step __default
    Speak "退出分支"
    Default __default
```

#### script09

测试非数字参数的报错

```text
# 测试listen的参数识别
Step hello
    Speak "hello,world"
    Listen 12 , aa25
```



